-- misc. (latest first, mostly)
set search_path = folklore, ne, public;

-- nearest neighbor to a motif/vector
-- "New race made of red earth after world calamity.""
SELECT motif_id, 
	motif_text, 
	embedding <-> '[0.01138772,-0.04109773,-0.009704377,-0.017222418,-0.006190145,-0.009315397,-0.01667248,-0.0139496215,-0.0006857446,-0.009818388,-0.0104085645,0.009248331,-0.0014217884,-0.012749149,-0.0023104062,0.016310327,0.023969207,-0.007296725,-0.0032727958,-0.0026088476,-0.0029190255,0.038602896,0.0011317302,0.0030531564,6.931847e-05,-0.008195403,0.014432494,-0.0042553055,0.03095743,-0.00037619547,0.0008144265,-0.023338791,-0.0006161642,-0.016055478,-0.026396977,0.006344395,0.009563539,-0.017544333,0.009556833,-0.022010894,-0.0060258345,-0.004788476,0.011837059,-0.00891971,-0.023231486,-0.015210453,-0.011890711,-0.00020004378,-0.015129974,0.0057072733,0.021541435,0.012708911,-0.0021192695,-0.009597071,-0.025015427,-0.0010621496,0.0068607996,0.01238029,-0.0036684822,-0.014110579,0.014673929,0.010381738,-0.015317758,0.020334257,-0.004627519,-0.011427959,0.0018560374,0.0059788884,-0.0013111304,-0.0052042822,0.026048236,-0.013218608,0.014928778,-0.027201762,0.014150818,-0.0017219065,-0.013091183,-0.007645466,0.02394238,-0.0036550693,0.021675566,-0.013178369,-0.024385013,0.0072900187,0.026142128,0.00041790184,-0.03004534,0.008711807,-0.0034136334,-0.0022081314,0.0100933565,0.011964483,0.017933313,0.015867695,-0.04302922,0.007108942,-0.013761839,0.03511549,0.013178369,-0.061324682,7.9902245e-05,0.017302897,-0.0038629721,-0.01160233,-0.011702928,-0.011394427,0.0018862169,-0.00646176,0.028006548,0.0016816672,-0.010924968,0.012440648,0.032674305,-0.028140679,0.014606863,-0.0064919395,0.016887091,-0.009804974,-0.0020304078,-0.00094227016,0.011199937,0.027738286,0.0010411917,0.0052009285,0.005559729,0.022319395,-0.024519144,-0.007873489,0.013721599,-0.00835636,-0.01138772,0.0020270543,0.008604502,0.0053954185,-0.0095232995,0.028247984,-0.016913917,0.0044062026,-0.022842506,-0.017329723,0.0026725598,0.010173835,0.0072296597,-0.0020371142,-0.0058581703,0.031923175,-0.016176196,0.006203558,0.0060794866,-0.01887223,0.029106423,-0.0014678959,0.030447733,-0.00833624,0.02398262,-0.0037053684,-0.009818388,0.016860263,-0.015183627,-0.0007100559,-0.014217884,-0.003004534,-0.002781541,-0.021071976,0.034739923,0.020454975,0.014459319,-0.008973363,0.004080935,-0.0141910575,-0.016954156,0.023338791,-0.02619578,0.022708375,-0.009201385,0.020079408,-0.0028636963,0.018590555,-0.008510611,-0.0020740002,-0.029669773,0.005972182,0.022131613,0.00891971,0.0020538806,-0.023365617,0.014580037,-0.017544333,-0.007705825,-0.014566625,0.00013821779,0.01350699,-0.016337153,0.003618183,-0.6682942,-0.01910025,-0.002801661,0.0013413097,-0.0073369644,0.004335784,0.014888539,-0.0013631061,-0.004275425,-0.012608312,-0.002042144,0.012460768,-0.024210641,-0.018067444,-0.0044430885,-0.012775976,0.00322082,-0.0019482524,-0.015706738,0.0073235515,-0.03173539,0.0018141215,-0.00818199,0.005972182,0.007913728,0.029294206,0.00322082,0.0005386197,-0.0143251885,0.0050030854,-0.016820025,-0.00042293174,-0.020119647,0.00928857,0.0661534,-0.0070888223,-0.018550314,0.029803904,0.028006548,0.006914452,-0.010509162,0.015854282,0.018805163,-0.014875126,-0.0015282548,0.0063678683,0.00913432,-0.022440113,0.025914105,-0.00928857,0.021460956,0.017463854,0.0055932617,0.04893098,0.028757682,0.01138772,0.016940743,0.006813854,0.005620088,0.009711083,-0.010750598,0.019086838,-0.011595624,-0.02779194,-0.00835636,0.0078869015,-0.02125976,0.018644206,0.019811146,-0.022466939,-0.008772166,0.012802802,-0.0052009285,-0.002167892,0.010167128,-0.0032644127,0.029106423,-0.021165868,0.0064718197,0.008892884,0.0058346977,0.0036919552,0.006609304,0.010133595,0.017437028,-0.03329131,-0.040319774,0.0066394834,0.0033499212,0.0150763225,-0.0061197258,0.022668136,-0.0070888223,0.00042293174,0.017946726,-0.009335516,0.0033348314,0.014901952,-0.0027262121,-0.016739545,-0.009422701,-0.0074040303,0.0073839105,0.0050131455,-0.011904124,0.0068339733,-0.00948306,0.013178369,0.035356928,-0.024639862,0.020119647,0.017960139,-0.021206107,0.006069427,-0.0064282273,-0.018000377,0.01216568,0.017088287,0.0042921915,-0.029723424,0.012769269,0.018684445,0.008410012,4.8150927e-05,0.0013597528,0.00893983,0.0025216625,0.027470024,-0.020374496,-0.030715995,0.003762374,0.011649275,0.034176573,0.0006857446,0.020294018,-0.017785767,0.009771442,-0.010623174,-0.001270891,-0.014405667,-0.017678464,0.00969767,0.0073436713,-0.0064550536,-0.0028838161,-0.0065522986,-0.017638223,0.0015668175,-0.040427078,-0.005757572,-0.0012666994,-0.0106030535,-0.038495593,-0.02112563,-0.015532368,0.0064282273,0.0045369803,-0.015357997,-0.02290957,-0.015559194,0.024532557,0.014231297,-0.0066763693,-0.0026038177,0.012541247,-0.0069345715,-0.05563753,0.029696599,-0.0031034555,-0.018147921,-0.015129974,-0.034042444,-0.007685705,0.021206107,-0.008215522,0.0069949306,-0.024130164,-0.02411675,-0.014942192,0.012889987,-0.0072833123,0.014875126,-0.014432494,-0.0036986617,0.00091544393,-0.0057743387,0.007182714,-0.0024696866,0.0036953085,0.03342544,-0.0018795104,0.013453337,0.00027266314,-0.0012298134,0.015827456,-0.010623174,-0.0129905855,-0.010100063,-0.0024009445,0.010234194,0.017477266,-0.014834886,0.035008185,-0.004765003,0.025739735,-0.027738286,-0.0027111224,-0.04090995,0.01311801,0.016484698,0.0015156801,-0.018054029,-0.02532393,-0.018992947,-0.0025803447,0.03052821,-0.0034874054,0.0046208124,-0.009965932,-0.0075784004,-0.024264295,0.016940743,0.01268879,-0.008752046,-0.03822733,0.0030430965,-0.008249056,0.0213,0.013493576,-0.039783247,0.003530998,0.017611397,0.018335706,0.0011493348,0.011676102,-0.016779786,0.013708186,0.006548945,0.0060023614,0.015720151,-0.003494112,0.01675296,0.0011560414,-0.020401321,0.02429112,-0.001026102,0.013735012,0.0026407037,-0.017128525,0.027899243,-0.0093422225,0.019864798,-0.010167128,-0.0072229533,-0.00091041403,-0.029079596,0.035517883,0.0073503777,0.020065995,0.022560831,0.0094025815,0.002005258,-0.0007159241,-0.0025853745,0.024264295,0.0029106422,0.006401401,0.0079875,0.008772166,-0.019153904,-0.01723583,-0.011568797,0.020803714,-0.036295842,-0.014392254,-0.008832525,-0.007927141,-0.023607053,0.0039400975,-0.017155353,0.013138129,-0.027872417,0.008416719,0.033747353,-0.022051133,-0.013735012,-0.032191437,0.0033029753,-0.009865333,0.02714811,0.006827267,0.022855919,0.0058447574,0.019288035,-0.009965932,-0.023633879,0.012608312,-0.019502643,0.016256675,-0.0071625942,-0.011166404,0.0064818794,-0.0055362564,0.0029894442,0.02013306,0.015545781,0.03291574,0.01541165,-0.012366876,-0.023633879,-0.018778337,-0.015129974,-0.01026102,-0.00065430766,0.0049661994,-0.015532368,0.009214798,-0.010120182,0.023915553,-0.0038059666,0.010334792,-0.025914105,-0.032969397,-0.019851385,0.101671286,0.010965208,-0.013433218,0.0048153023,0.015036083,-0.017195592,-0.02576656,-0.023110768,0.0035880038,-0.028838161,0.0005243683,0.0021829817,0.00022886098,-0.0006601759,-0.005080211,0.0056871534,0.002741302,-0.012755856,-0.02320466,-0.02792607,-0.008329534,0.007806423,0.0070955288,0.012386996,0.00246801,-0.000928857,0.019556297,0.00837648,0.0007305947,-0.0033801007,-0.005797812,0.0039367443,-0.010958501,0.0052579343,0.01970384,-0.0020169946,0.011126164,0.014459319,0.015156801,-0.02671889,0.02087078,0.013580762,0.007953967,-0.022721788,0.001881187,-0.0023975912,0.000768319,0.004090995,-0.021004912,-0.03321083,0.05451083,-0.0037489608,-0.04090995,-0.020294018,0.008524024,0.01965019,0.0072833123,0.001405022,-0.031493954,0.019837972,-0.023580227,-0.0065623582,-0.005532903,-0.0040239296,-0.022319395,-0.014888539,0.005952062,0.00835636,-0.03562519,0.01004641,-0.008088098,-0.033318136,-0.010851196,0.015438476,0.018456424,0.006572418,0.026437216,-0.018724686,-0.014271536,-0.010321379,0.00055203284,-0.023660704,-0.012889987,0.0117297545,0.009945812,0.0044263224,-0.0040943483,-0.02199748,-0.010193954,0.02003917,0.023660704,-0.009509887,0.011025567,0.013299087,0.0004707159,0.013761839,0.02757733,-0.008403306,-0.008309415,0.009885454,0.006193498,-0.021675566,-0.027523678,-0.003064893,0.020629345,-0.0013086153,-0.008544143,0.015116561,0.0062739765,-0.0093422225,0.0037824935,-0.023137594,0.008651448,-0.0076789986,-0.011374307,0.01671272,0.017276071,0.022064546,-0.023660704,-0.014727581,0.0031571079,-0.036993325,0.0031604613,0.01887223,0.0048153023,0.015988413,0.004999732,-0.008081391,-0.004899134,0.013171663,-0.013728306,0.03052821,0.008054566,0.01368136,-0.015800629,-0.0066663097,0.02415699,0.010810957,0.006183438,-0.005214342,-0.020065995,-0.004107761,0.012031549,-0.012152267,-0.033881485,-0.019998929,-0.0025635783,0.0235534,-0.0030632163,-0.0025250157,-0.011998016,-0.018201575,-0.010361618,0.020682996,-0.016967569,-0.019234382,-0.028247984,-0.01700781,0.0057240394,0.029562468,0.03498136,0.0033951905,0.022936398,-0.002491483,-0.00041475813,0.0017319663,0.006183438,-0.0035343512,-0.029803904,-0.004044049,0.012266278,0.017182179,-0.008135044,-0.019636776,0.005217695,0.014901952,-0.018550314,0.009040428,0.007216247,-0.05858841,-0.012152267,0.0014846623,-0.021662153,0.011474906,-0.005700567,-0.008557556,0.017410202,-0.0056972136,-0.018684445,0.006612657,0.022252329,0.009617191,0.025605604,-0.00096574303,0.004090995,-0.014875126,-0.0131247165,0.012668671,0.0037724338,0.009771442,0.01918073,0.009409288,0.004218419,-0.00027895052,0.006803794,0.013285673,0.025538538,-0.017289484,-0.0031738742,-0.024398426,-0.00016221465,6.0830494e-05,-0.016377393,-0.03146713,0.010173835,-0.016632242,-0.03173539,0.031386647,-0.0027396253,-0.014687343,0.0201733,-0.00033826157,0.020159887,-0.0030632163,0.022051133,-0.0008902944,-0.018107682,-0.01309789,0.01978432,-0.014378841,-0.0147007555,0.034391183,0.0002225736,-0.03554471,-0.019583123,-0.0032845323,0.015277519,-0.015666498,-0.013922796,0.0034287232,0.010301259,0.018295465,-0.026866436,-0.009100787,0.0147007555,-0.015545781,-0.010234194,-0.0269335,0.0029961509,0.004225126,-0.023848489,0.011012154,-0.01970384,0.028623551,-0.004201653,-0.011327361,0.007390617,-0.014969017,-0.016511524,-0.0082021095,-0.0121858,0.022842506,0.0036014167,-0.0112938285,-0.0008768813,-0.012682084,-0.0094025815,-0.004996379,-0.024277708,0.028864987,-0.016444458,0.0007335288,-0.02065617,0.030903777,0.018764924,0.030286776,-0.013775252,0.009845214,-0.02701398,0.0070552896,0.022225503,-0.003494112,-0.008021032,-0.0047381767,-0.024197228,-0.021380479,-0.019167317,0.0009590365,0.024975188,-0.016001826,-0.002107533,0.011877298,0.002560225,0.0012524481,0.010073236,0.0048153023,-0.018496662,0.02372777,-0.028462594,0.010589641,0.02506908,0.025256863,-0.0057139797,0.02359364,0.03347909,-0.00025820214,0.015277519,-0.024773993,-0.025297103,0.0022852565,-0.023848489,-0.015907934,-0.017557746,-0.0021595089,0.027818765,0.019583123,0.019663602,-0.028811334,0.00037032724,0.023674117,0.017182179,-0.0041580605,-0.0028670498,-0.024478903,0.01675296,-0.019797733,-0.008845938,0.027765112,-0.020361083,-0.0060929,0.0071693007,0.023285137,-0.015814042,-0.02996486,-0.026343325,-0.00950318,-0.008866058,-0.009469647,0.03224509,-0.011012154,0.023151007,0.029803904,0.012910107,0.0068809194,-0.00644164,-0.026182367,-0.003775787,-0.014016687,-0.01424471,-0.031172039,0.014660516,0.04541675,0.0014687342,-0.016189609,-0.025149558,0.012112027,-0.036939673,-0.018174747,0.001078916,0.004667758,0.0382005,0.006327629,0.008631328,0.025109319,-0.0063578086,-0.0012272985,0.009711083,0.005227755,-0.000607781,-0.014217884,0.012668671,0.009073961,-0.023928966,0.025310516,0.009000189,0.018295465,0.026249433,-0.010180541,-0.012420529,0.008168576,0.0006249665,0.024559382,0.017410202,0.010301259,-0.008597796,-0.037395716,-0.018349119,0.008302707,0.0039266846,-0.006324276,-0.0010965208,0.017557746,-0.008544143,-0.013325913,0.016739545,-0.0074576824,-0.018885642,-0.031493954,0.028999118,-0.011575503,-0.030555038,0.036993325,0.009275157,-0.015706738,0.0065791244,-0.0053317063,0.015532368,0.004315664,-0.0043458436,-0.0018828636,0.03763715,-0.0037087216,0.0029609413,-0.038602896,0.0036450094,-0.0055027236,-0.015505541,-0.029884383,0.02398262,0.030072166,-0.0060023614,-0.006300803,-0.007551574,-0.014942192,-0.016377393,-0.017544333,-0.013963035,-0.008436838,-0.0048186556,0.004788476,-0.0017151999,-0.018550314,0.013285673,-0.019060012,-0.022077959,0.027054219,0.21106851,0.0039166245,0.014432494,0.019797733,-0.015706738,0.023486335,0.018107682,-0.00514057,-0.011816939,0.013775252,-0.014231297,0.012232745,0.004520214,-0.004124528,-0.016967569,0.0020589104,-0.02415699,0.011816939,-0.017678464,-0.0028452533,0.006659603,-0.014995843,-0.03173539,-0.016243262,0.01783942,-0.01848325,-0.005925236,-0.0031839341,0.027952896,0.0117901135,0.0062236777,-0.0055932617,0.008135044,0.0021460957,0.0035645308,-0.011823646,0.028891813,-0.0050131455,0.007645466,0.010696946,-0.004064169,-0.0029408217,0.022708375,0.002763098,-0.024130164,0.010904849,-0.016833438,-0.0028351936,-0.012621725,-0.0040239296,-0.017651636,-0.014150818,0.008503905,0.01745044,0.021353653,0.01288328,0.021487784,0.0030699228,-0.013413098,0.0075314543,-0.021796284,0.0224267,-0.016779786,0.029240554,-0.020200126,0.009918986,-0.023405856,-0.021662153,0.0243716,-0.01622985,0.0019331628,-0.020884193,0.003725488,-0.0053216466,-0.0026239373,-0.019636776,0.008631328,0.021662153,0.007256486,0.028221158,-0.015223866,-5.9049067e-05,0.0060996064,-0.008436838,-0.006086193,-0.012454062,0.009107494,0.00028377085,-0.036295842,0.01562626,0.0025082494,-0.011682808,7.874956e-05,-0.008114925,0.024988601,0.007256486,0.02376801,0.009845214,-0.0019348394,0.0072900187,-0.02429112,-0.009731202,0.014928778,0.008430132,-0.02095126,0.013802078,-0.020884193,0.015800629,0.008886177,-0.015572607,-0.0029424983,-0.013828904,-0.0036215365,-0.013171663,0.015787216,0.011240176,-0.009127613,-0.003812673,0.0056100283,-0.0071156486,-0.008785579,-0.039890554,-0.010549402,-0.011884005,-0.016940743,-0.02003917,0.005388712,0.0052210484,0.0023607053,-0.043163348,0.00967755,-0.030689169,0.013963035,-0.002441184,0.009865333,0.030072166,0.015317758,-0.014942192,-0.00091041403,0.0019901684,0.016471284,0.009878746,0.02996486,-0.021836523,-0.007082116,-0.008135044,0.0050131455,0.013339326,-0.024183815,-0.0029324386,-0.052793954,-0.005911823,0.0029508816,-0.0030430965,0.0078265425,-0.014043514,-0.032942567,-0.019140491,0.00928857,0.03935403,-0.02320466,0.02545806,0.011059099,-0.012011429,-0.014553212,-0.011159698,-0.17265339,0.009255038,0.023741184,-0.013104597,0.025122732,-0.025310516,-0.0024596269,0.016699307,-0.03157443,0.037717633,0.034578968,0.027161524,-0.038039546,-0.0010185571,0.0015726858,0.02528369,-0.020065995,0.023392443,0.0112334695,0.01584087,-0.002675913,-0.0068105003,-0.0028670498,0.0077728904,0.0013069387,0.01978432,0.0053618858,0.02429112,0.01346675,0.0056737405,-0.04168791,-0.02147437,0.030259948,0.01614937,-0.027268829,-0.014231297,-0.010126889,-0.0082021095,-0.016994394,0.007196127,0.0032325566,-0.021769458,0.015116561,-0.005371946,-0.010992033,0.032942567,0.014539798,-0.00608284,0.004241892,-0.010851196,0.01671272,-0.011649275,-0.0067602014,0.010743892,0.049977202,0.036081232,0.01043539,0.0015290931,0.019033186,-0.0033012987,-0.031815868,-0.00035502794,0.0017487326,-0.008564263,-0.012373582,-0.029723424,0.00057257165,0.0064315805,-0.03350592,0.0112938285,-0.009972638,-0.00080772,0.007196127,-0.010764011,0.0064885863,-0.0021528022,-0.035142317,-0.0015064586,-0.014955604,-0.034713097,-0.02983073,0.035222795,0.0080076195,-0.005579849,0.012957052,0.008631328,-0.018443009,0.008664861,-0.028677203,-0.013567349,0.003591357,-0.023137594,0.0041848863,-0.03447166,-0.009590365,0.01653835,-0.0027295654,-0.0068607996,0.015183627,-0.013406391,0.019328274,0.0015014287,-0.027630981,0.002763098,0.04646297,0.0045604534,-0.006317569,0.0012775976,0.045014355,0.016645655,0.0073637906,0.009744615,0.002625614,0.017249243,0.0033314782,-0.004469915,0.011427959,0.002246694,0.01675296,0.012004723,0.041634258,0.0019583122,-0.006827267,0.0070351698,0.007571694,-0.019811146,-0.102690674,0.005482604,-0.014123992,-0.0026306438,0.003762374,0.031896345,0.014526385,-0.011850472,-0.0018560374,0.022198677,-0.010743892,-0.013238728,0.0060258345,0.0052713477,0.048609067,0.00025401055,-0.01653835,0.017504092,-0.007269899,0.01766505,-0.014660516,-0.0058447574,-0.0024428605,-0.025619017,0.0077930097,0.0074107368,-0.03208413,0.0023640585,0.014566625,0.020414734,-0.0053451196,-0.0055161365,0.008081391,-0.008946536,-0.009804974,-0.004201653,-0.03948816,-0.0036684822,0.0153311705,-0.031896345,0.005563082,0.008557556,-0.0051238034,-0.005972182,-0.0011669395,0.0011082572,0.005435658,0.04477292,0.01138772,-0.02749685,-0.020374496,-0.028328463,-0.01593476,0.009590365,0.007135768,-0.036483627,0.01766505,0.012889987,-0.0193551,0.017785767,0.0019398693,0.010509162,-0.017745528,0.008684981,-0.003909918,-0.010006171,-0.0129034,0.022748614,0.016350565,-0.029294206,-0.017289484,0.016484698,-0.021447543,-0.009818388,-0.015290932,0.012152267,-0.024210641,-0.0032828557,0.035088666,-0.013413098,-0.021165868,-0.0062706233,0.0041144677,-0.022265743,0.023754597,0.020428149,-0.0182284,-0.01809427,0.01762481,-0.00093807856,-0.011199937,-0.01428495,0.010549402,-0.035142317,-0.008879471,0.039622292,0.0026792663,0.0024478904,-0.004885721,-0.021192694,-0.014030101,-0.016524937,-0.058695715,0.03680554,-0.0012189152,-0.012843042,0.005794458,-0.014606863,0.023271725,-0.012172386,-0.029535642,0.012769269,-0.0093422225,0.03541058,0.00078676204,-0.021273173,-0.021273173,0.0020035815,0.013614294,0.0032543528,0.015478715,-0.011528558,-0.0025082494,-0.005566436,0.01121335,-0.006300803,0.0035041717,-0.014714168,-0.011629156,0.0078869015,-0.016873676,-0.010274433,0.008731927,-0.020978086,0.013989861,0.031279344,0.0036081234,-0.016511524,-0.009590365,0.0020555572,0.0024328006,0.022976637,-0.030072166,-0.027845591,0.0078265425,0.0048689544,-0.01632374,0.009825095,0.0029290852,0.004962846,0.017249243,0.021219522,0.024411839,0.023097355,-0.009912279,0.00081400736,-0.026222607,-0.021407304,0.024881296,0.024478903,0.00475159,-0.008034445,0.032942567,0.002607171,0.01636398,-0.0070687025,-0.010375031,-0.0133125,0.0076521724,-0.005606675,-0.0051003303,-0.027470024,0.0003296688,0.021071976,0.020441562,0.0061398456,0.0019046599,-0.009449528,0.012641845,-0.01684685,-0.023392443,0.016109131,-0.007705825,0.005975535,-0.06030529,0.02848942,0.0068105003,0.010891436,-0.006478526,-0.0054188916,0.005603322,0.024103338,-0.006387988,0.01272903,0.024867883,0.015398236,-0.022171851,0.005643561,-0.0038394993,0.00304645,0.03736889,0.025592191,-0.008094804,-0.013667947,0.0021175928,-0.0037556675,-0.015425063,0.019422166,-0.0038696788,0.015572607,-0.0019616655,0.014928778,0.010375031,2.4285042e-05,0.0038529125,0.024103338,-0.014459319,0.012588193,0.007155888,-0.004811949,-0.010683533,0.037985895,0.0032509996,0.024304533,-0.001328735,-0.0020756768,0.015398236,-0.0005658651,0.011884005,-0.011977896,0.009804974,-0.005482604,0.02095126,-0.006344395,-0.0028871694,-0.012474181,-0.020025754,0.018174747,0.013533816,0.02913325,-0.010522575,0.02905277,0.026557934,-0.0051640426,0.017866246,0.00570392,0.022319395,0.010375031,0.019891623,-0.0070888223,-0.03146713,-0.0291869,-0.010079944,0.023821661,0.016766373,-0.026517695,0.02757733,-0.004433029,0.01918073,-0.032057304,0.004386083,0.027872417,-0.014298363,0.05494005,0.018778337,-0.014003274,-0.009234918,0.0013304116,0.0021779519,-0.0037221347,0.008584383,0.0031286052,0.0075180414,-0.023888728,-0.016860263,-0.0148214735,-0.001712685,0.008275881,0.00072263065,0.010113476,-0.0009850244,-0.0036818953,0.015116561,-0.014365428,-0.021554848,0.0049293134,-0.011783406,-0.010234194,-0.027309068,-0.012058375]'::vector AS distance
FROM motif_embeddings
ORDER BY distance
LIMIT 20;

-- First, let's rename the old table as a backup
ALTER TABLE folklore.motif_embeddings RENAME TO motif_embeddings_old;

-- Now, create a new table with the correct dimensions
CREATE TABLE motif_embeddings (
    id SERIAL PRIMARY KEY,
    motif_id VARCHAR(255),
    motif_text TEXT,
    embedding vector(1536) -- 
);

-- how many motifs have no references? 4255 are blank in tmi.json
select distinct(motif_id) from motif_ref mr; -- 34208/46245 73%
select count(*) from motif_text mt;

-- generate some data for embeddings
WITH combined_data AS (
    SELECT 
        mt.motif_id,
        mt.text AS motif_text,
        mr.ref_term,
        rp.class
    FROM 
        motif_text mt
    LEFT JOIN 
        motif_ref mr ON mt.motif_id = mr.motif_id
    LEFT JOIN 
        ref_place rp ON mr.ref_term = rp.ref_term
)
SELECT 
    ROW_NUMBER() OVER(ORDER BY motif_id) AS rownum,
    motif_id,
    CASE 
        -- Check if there are any valid ref_terms before concatenating the prefix
        WHEN COUNT(ref_term) FILTER (WHERE ref_term IS NOT NULL) > 0 THEN
            CONCAT(
                motif_text, ' ',
                COALESCE(
                    STRING_AGG(
                        CASE 
                            -- Apply appropriate prefix based on the class of each reference term
                            WHEN class = 'adm1' THEN CONCAT('Found in ', ref_term)
                            WHEN class = 'cty' THEN CONCAT('Linked to ', ref_term)
                            WHEN class = 'isl' THEN CONCAT('Located in ', ref_term)
                            WHEN class = 'trb' THEN CONCAT('Associated with the tribe ', ref_term)
                            WHEN class = 'con' THEN CONCAT('On the continent of ', ref_term)
                            WHEN class = 'multi' THEN CONCAT('Spanning multiple countries: ', ref_term)
                            WHEN class = 'lng' THEN CONCAT('In languages spoken in ', ref_term)
                            WHEN class = 'rgn' THEN CONCAT('From the region of ', ref_term)
                            WHEN class = 'hrgn' THEN CONCAT('In the historic region of ', ref_term)
                            WHEN class = 'rel' THEN CONCAT('Referenced in ', ref_term, ' religious texts')
                            WHEN class = 'eth' THEN CONCAT('Linked to the ethnicity ', ref_term)
                            ELSE CONCAT('Linked to ', ref_term)
                        END, ', '
                    ),
                    ''
                )
            )
        ELSE motif_text  -- No prefix added if there are no ref_terms
    END AS motif_text_with_references
--into embed_text
FROM 
    combined_data
GROUP BY 
    motif_id, motif_text
ORDER BY 
    motif_id;
   
-- *** PRELIMINARY PLACE STUFF *** --
-- motif_ref (motif_id, ref_term (fk))
-- ref_place (ref_id, ref_term, place_names_array, class, ccodes_array, variants, 
-- 			subregion, country_array)
select ref_id, country_array, a0.region_un, a0.subregion
	from ref_place rp 
	join admin0_10m a0
	on rp.ccodes_array[1] = a0.iso_a2; -- only 250 have ccodes so far

update ref_place set subregion = a0.subregion
	from admin0_10m a0
	where ccodes_array[1] = a0.iso_a2;

update ref_place set subregion = null
	where ref_term like 'No. Am.%';

select distinct(subregion) from ne.admin0_10m am order by subregion;

select subregion, count(*) from ref_place rp 
	group by subregion order by count desc;
select count(*) from ref_place rp; -- 267/819


--Antarctica
--Australia and New Zealand
--Caribbean
--Central America
--Central Asia
--Eastern Africa
--Eastern Asia
--Eastern Europe
--Melanesia
--Micronesia
--Middle Africa
--Northern Africa
--Northern America
--Northern Europe
--Polynesia
--Seven seas (open ocean)
--South America
--South-Eastern Asia
--Southern Africa
--Southern Asia
--Southern Europe
--Western Africa
--Western Asia
--Western Europe

ALTER TABLE ref_place 
ADD COLUMN ccodes_array TEXT[];

UPDATE ref_place
SET ccodes_array = string_to_array(ccodes, ',');

ALTER TABLE ref_place 
ADD COLUMN place_names_array TEXT[];

UPDATE ref_place
SET place_names_array = string_to_array(place_names, ',');

ALTER TABLE ref_place 
ADD COLUMN country_array TEXT[];

UPDATE ref_place
SET country_array = string_to_array(country, ',');
